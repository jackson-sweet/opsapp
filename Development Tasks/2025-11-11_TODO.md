# TODO - November 11, 2025

## High Priority

### Calendar & Scheduling
- [x] **Switching to task-based scheduling not deactivating project calendar event** - FIXED
  - ✅ Added robust calendar event deactivation logic
  - ✅ Tries primary calendar event first, then searches by project ID
  - ✅ Properly deactivates project calendar event when switching to task-based scheduling

- [x] **Task creation: Pre-filter scheduler by selected team members** - COMPLETED (Nov 12, 2025)
  - ✅ Added preselectedTeamMemberIds parameter to CalendarSchedulerSheet
  - ✅ Updated filterCalendarEvents() to use preselected team members when provided
  - ✅ Updated hasTeamConflicts() to use preselected team members when provided
  - ✅ TaskFormSheet now passes selectedTeamMemberIds to scheduler
  - When creating a new task with team members selected, scheduler automatically filters to show only events with overlapping team members

### UI/UX Improvements

- [x] **Project Details View closing and reopening bug** - FIXED
  - ✅ Removed problematic onDismiss handler in ProjectSheetContainer
  - ✅ onDismiss was incorrectly firing when child sheets (scheduler, etc.) were dismissed
  - ✅ ProjectDetailsView now remains open when action sheets are dismissed
  - ✅ SwiftUI binding automatically handles manual swipe-to-dismiss

- [x] **Project list animation in calendar view** - COMPLETED
  - ✅ Added smooth fade-in and slide-up animation (0.3s ease-out)
  - ✅ Animation triggers when view appears
  - ✅ Animation resets and plays when date changes
  - ✅ Applied to both empty state and project list content

- [x] **Team member section expansion animation** - COMPLETED
  - ✅ Added smooth expand/collapse animation when entering/exiting edit mode
  - ✅ "Add Team Members" section animates in with opacity + move transition
  - ✅ Checkbox/chevron icons animate with scale + opacity transition
  - ✅ 0.3s easeInOut animation for section, 0.25s for icon transitions

- [x] **Task Details View: Inline team member editing** - COMPLETED
  - ✅ Created TaskTeamView component for inline editing
  - ✅ Replaced assign team sheet with inline editing (matching ProjectDetailsView)
  - ✅ Added same animations as ProjectTeamView (expand/collapse, checkbox transitions)
  - ✅ Team members load from SwiftData query
  - ✅ Edit/Done button toggles inline editing mode

- [x] **5s hang when tapping 'SWITCH TO TASK BASED SCHEDULING'** - FIXED
  - ✅ Moved alerts from nested computed property to top level
  - ✅ Moved "Switch to Task-Based Scheduling" alert to main body
  - ✅ Moved "Switch to Project-Based Scheduling" alert to main body
  - ✅ Alert now appears instantly instead of 5s hang

- [x] **Team editing with 0 members not working** - FIXED
  - ✅ Fixed TaskTeamView to show available members when editing even with 0 current members
  - ✅ Fixed ProjectTeamView to show available members when editing even with 0 current members
  - ✅ Edit button now works correctly in empty state

- [x] **Dropdown/expand section touch responsiveness** - FIXED
  - ✅ Replaced Button wrapper with .onTapGesture for better touch handling
  - ✅ Kept .contentShape(Rectangle()) to ensure entire HStack is tappable
  - ✅ Applied to CollapsibleSection used in Job Board and Project List
  - ✅ Entire dropdown header now responds to touch, not just chevron

- [x] **Job board drag-and-drop status persistence** - FIXED
  - ✅ Added immediate backend API call when status changes via drag-and-drop
  - ✅ Status now syncs to Bubble immediately after local update
  - ✅ Added proper error handling with needsSync fallback
  - ✅ Status changes persist across app restarts and syncs

- [x] **Haptic feedback on all successful saves** - COMPLETED
  - ✅ Added haptic feedback to saveNotes() in ProjectDetailsView
  - ✅ Added haptic feedback to saveTaskNotes() in TaskDetailsView
  - ✅ Added haptic feedback to saveTeamChanges() in ProjectTeamView
  - ✅ Added haptic feedback to saveTeamChanges() in TaskTeamView
  - ✅ saveAddress() already had haptic feedback
  - ✅ Status updates already had haptic feedback

- [x] **Project Details View: Address field formatting** - COMPLETED
  - ✅ Address field already has full inline editing functionality
  - ✅ TextField with autocomplete when editing
  - ✅ Save/Cancel buttons appear when editing
  - ✅ Live map preview during editing

- [x] **Project & Task Details View: Notes field cleanup** - COMPLETED
  - ✅ Removed duplicate 'NOTES' title from within ExpandableNotesView
  - ✅ Moved chevron inline with section heading (PROJECT NOTES / TASK NOTES)
  - ✅ Chevron formatting matches client and start date fields (chevron.up/down, size 14)
  - ✅ Header now clickable to expand/collapse notes

- [x] **Project Details View: Add edit button for title** - COMPLETED
  - ✅ Title field now has inline editing with edit button
  - ✅ Save/Cancel buttons appear when editing
  - ✅ Haptic feedback on save
  - ✅ Syncs to API immediately
  - Note: Client editing would require complex client selection UI, deferred

- [x] **Universal job card date format** - COMPLETED
  - ✅ Added DateHelper.simpleDateString() formatter
  - ✅ Updated UniversalJobBoardCard to use simplified format
  - ✅ Now shows "Nov. 4" instead of "Monday, November 4"

- [ ] **Day sheet in calendar month view**
  - Project cards should use same template as week view's project list
  - Lists should be identical between day sheet and week view

- [ ] **Sync notification safe area issue**
  - 'Connection restored, 1 item syncing' notification needs to ignore top safe area
  - Should extend to edge of screen at top

- [x] **Universal job card improvements** - COMPLETED (Nov 12, 2025)
  - ✅ Added badge beneath status badge showing "PROJECT" or "X TASKS"
  - ✅ Badge indicates whether project uses project-based or task-based scheduling
  - ✅ Removed project/task indicator from metadata line
  - ✅ Limited address text to 40% of card width to prevent overflow
  - ✅ Show only street number and street name in address (removed city)
  - ✅ Added formatAddressStreetOnly() helper function

### Backend/Data

- [x] **Project photos not syncing from cloud** - FIXED
  - ✅ Added projectImages sync logic to CentralizedSyncManager
  - ✅ Photos uploaded from other devices now download correctly
  - ✅ Handles both photo additions and deletions from server
  - ✅ Cleans up local cache when photos are removed
  - Photos will sync on next manual refresh or automatic sync

- [x] **Rename task status from 'scheduled' to 'Booked'** - COMPLETED
  - ✅ iOS app fully migrated to "Booked" status
  - ✅ Custom decoder handles legacy "Scheduled" data
  - ✅ DTOs map old "Scheduled" to "Booked"
  - ✅ All UI references updated
  - ⚠️ **Still needed: Update Bubble backend** to use "Booked" instead of "Scheduled"

### Bug Fixes

- [x] **'Loading projects' overlay stuck at halfway** - FIXED
  - ✅ Fixed TacticalLoadingBarAnimated timer reference storage
  - ✅ Timer now properly retained and added to main run loop
  - ✅ Added withAnimation to state changes for smooth transitions
  - ✅ Added onDisappear to clean up timer
  - ✅ Animation now runs continuously instead of getting stuck

- [ ] **Bubble: Mobile app download prompt after signup**
  - Show popup to download app when user is on mobile device
  - Display after signup is complete and user is logged in

## Completed ✓

- [x] **Rename task status from 'scheduled' to 'Booked'** - COMPLETED (Nov 11, 2025)
  - ✅ iOS app fully migrated to "Booked" status
  - ✅ Custom decoder handles legacy "Scheduled" data
  - ✅ DTOs map old "Scheduled" to "Booked"
  - ✅ All UI references updated
  - ⚠️ **Still needed: Update Bubble backend** to use "Booked" instead of "Scheduled"

- [x] **Switching to task-based scheduling not deactivating project calendar event** - FIXED (Nov 11, 2025)
  - ✅ Added robust calendar event deactivation logic
  - ✅ Tries primary calendar event first, then searches by project ID
  - ✅ Properly deactivates project calendar event when switching to task-based scheduling

- [x] **Project list animation in calendar view** - COMPLETED (Nov 11, 2025)
  - ✅ Added smooth fade-in and slide-up animation (0.3s ease-out)
  - ✅ Animation triggers when view appears
  - ✅ Animation resets and plays when date changes
  - ✅ Applied to both empty state and project list content

- [x] **Project Details View closing and reopening bug** - FIXED (Nov 11, 2025)
  - ✅ Removed problematic onDismiss handler in ProjectSheetContainer
  - ✅ onDismiss was incorrectly firing when child sheets (scheduler, etc.) were dismissed
  - ✅ ProjectDetailsView now remains open when action sheets are dismissed
  - ✅ SwiftUI binding automatically handles manual swipe-to-dismiss

- [x] **Team member section expansion animation** - COMPLETED (Nov 11, 2025)
  - ✅ Added smooth expand/collapse animation when entering/exiting edit mode
  - ✅ "Add Team Members" section animates in with opacity + move transition
  - ✅ Checkbox/chevron icons animate with scale + opacity transition
  - ✅ 0.3s easeInOut animation for section, 0.25s for icon transitions

- [x] **Task Details View: Inline team member editing** - COMPLETED (Nov 11, 2025)
  - ✅ Created TaskTeamView component for inline editing
  - ✅ Replaced assign team sheet with inline editing (matching ProjectDetailsView)
  - ✅ Added same animations as ProjectTeamView (expand/collapse, checkbox transitions)
  - ✅ Team members load from SwiftData query
  - ✅ Edit/Done button toggles inline editing mode

- [x] **5s hang when tapping 'SWITCH TO TASK BASED SCHEDULING'** - FIXED (Nov 11, 2025)
  - ✅ Moved alerts from nested computed property to top level
  - ✅ Moved "Switch to Task-Based Scheduling" alert to main body
  - ✅ Moved "Switch to Project-Based Scheduling" alert to main body
  - ✅ Alert now appears instantly instead of 5s hang

- [x] **Team editing with 0 members not working** - FIXED (Nov 11, 2025)
  - ✅ Fixed TaskTeamView to show available members when editing even with 0 current members
  - ✅ Fixed ProjectTeamView to show available members when editing even with 0 current members
  - ✅ Edit button now works correctly in empty state

- [x] **Dropdown/expand section touch responsiveness** - FIXED (Nov 11, 2025)
  - ✅ Replaced Button wrapper with .onTapGesture for better touch handling
  - ✅ Kept .contentShape(Rectangle()) to ensure entire HStack is tappable
  - ✅ Applied to CollapsibleSection used in Job Board and Project List
  - ✅ Entire dropdown header now responds to touch, not just chevron

- [x] **Job board drag-and-drop status persistence** - FIXED (Nov 11, 2025)
  - ✅ Added immediate backend API call when status changes via drag-and-drop
  - ✅ Status now syncs to Bubble immediately after local update
  - ✅ Added proper error handling with needsSync fallback
  - ✅ Status changes persist across app restarts and syncs

- [x] **Project photos not syncing from cloud** - FIXED (Nov 11, 2025)
  - ✅ Added projectImages sync logic to CentralizedSyncManager
  - ✅ Photos uploaded from other devices now download correctly
  - ✅ Handles both photo additions and deletions from server
  - ✅ Cleans up local cache when photos are removed
  - Photos will sync on next manual refresh or automatic sync

- [x] **Week view swipe hang** (4.47s delay) - FIXED
  - Fixed SwiftData thread safety violation
  - Removed background threading that was causing crashes
  - Made projectCount(for:) cache-only to prevent UI blocking

- [x] **Calendar month grid view: Today cell styling** - FIXED
  - Today has primaryAccent background (opacity 0.5)
  - Selected day shows outline only when day sheet is visible
  - Outline clears when sheet is dismissed

- [x] **Calendar week view: Today cell styling** - FIXED
  - Selected day correctly outlined
  - Today now has distinguishable background color (primaryAccent opacity 0.5)

- [x] **Universal job card date format** - COMPLETED (Nov 12, 2025)
  - ✅ Added DateHelper.simpleDateString() formatter
  - ✅ Updated UniversalJobBoardCard to use simplified format
  - ✅ Now shows "Nov. 4" instead of "Monday, November 4"

- [x] **Project & Task Details View: Notes field cleanup** - COMPLETED (Nov 12, 2025)
  - ✅ Removed duplicate 'NOTES' title from within ExpandableNotesView
  - ✅ Moved chevron inline with section heading (PROJECT NOTES / TASK NOTES)
  - ✅ Chevron formatting matches client and start date fields (chevron.up/down, size 14)
  - ✅ Header now clickable to expand/collapse notes

- [x] **Haptic feedback on all successful saves** - COMPLETED (Nov 12, 2025)
  - ✅ Added haptic feedback to saveNotes() in ProjectDetailsView
  - ✅ Added haptic feedback to saveTaskNotes() in TaskDetailsView
  - ✅ Added haptic feedback to saveTeamChanges() in ProjectTeamView
  - ✅ Added haptic feedback to saveTeamChanges() in TaskTeamView

- [x] **'Loading projects' overlay stuck at halfway** - FIXED (Nov 12, 2025)
  - ✅ Fixed TacticalLoadingBarAnimated timer reference storage
  - ✅ Timer now properly retained and added to main run loop
  - ✅ Added withAnimation to state changes for smooth transitions
  - ✅ Animation now runs continuously instead of getting stuck

- [x] **Project Details View: Add edit button for title** - COMPLETED (Nov 12, 2025)
  - ✅ Title field now has inline editing with edit button
  - ✅ Save/Cancel buttons appear when editing
  - ✅ Haptic feedback on save
  - ✅ Syncs to API immediately

- [x] **Universal job card improvements** - COMPLETED (Nov 12, 2025)
  - ✅ Added badge beneath status badge showing "PROJECT" or "X TASKS"
  - ✅ Badge indicates whether project uses project-based or task-based scheduling
  - ✅ Removed project/task indicator from metadata line (cleaner layout)
  - ✅ Limited address text to 40% of card width using GeometryReader
  - ✅ Show only street number and street name in address (removed city)
  - ✅ Added formatAddressStreetOnly() helper function for consistent address formatting

- [x] **Task creation: Pre-filter scheduler by selected team members** - COMPLETED (Nov 12, 2025)
  - ✅ Added preselectedTeamMemberIds parameter to CalendarSchedulerSheet
  - ✅ Updated filterCalendarEvents() to use preselected team members when provided
  - ✅ Updated hasTeamConflicts() to use preselected team members when provided
  - ✅ TaskFormSheet now passes selectedTeamMemberIds to scheduler
  - ✅ Scheduler automatically filters events to show conflicts with selected team members
