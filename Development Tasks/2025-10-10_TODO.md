# Development Tasks - October 10, 2025

## Critical Bugs

### 1. Add Project from Client Card Quick Actions ✅ COMPLETED
**Issue**: When adding a project from client card quick actions, the project is not being properly linked to both the client and company.

**Status**: ✅ All functionality implemented and tested

**Completed fixes**:
- ✅ Added `linkProjectToClient()` in ProjectEndpoints.swift (lines 361-404)
- ✅ Added `linkProjectToCompany()` in ProjectEndpoints.swift (lines 406-449)
- ✅ Updated ProjectFormSheet.swift to call both linking functions after project creation (lines 790-795)
- ✅ Added `createCalendarEventForProject()` in ProjectFormSheet.swift (lines 863-906)
- ✅ Calendar event created when project is created with dates (line 799)
- ✅ Added `createCalendarEventForProject()` in ProjectDetailsView.swift (lines 417-462)
- ✅ Calendar event created when scheduling project without one (lines 371-376)
- ✅ Added `createCalendarEventForTask()` in TaskListView.swift (lines 351-402)
- ✅ Calendar event created when scheduling task without one (lines 292-303)

**Files modified**:
- ProjectEndpoints.swift
- ProjectFormSheet.swift
- ProjectDetailsView.swift
- TaskListView.swift

---

### 2. Add Client from Job Board Quick Actions ✅ COMPLETED
**Issue**: When adding a new client from job board quick actions, the client is not being added to the company's client list.

**Status**: ✅ Functionality implemented and tested

**Completed fixes**:
- ✅ Added `linkClientToCompany()` in ClientEndpoints.swift (lines 255-298)
- ✅ Updated ClientFormSheet.swift to call linking function after client creation (lines 353-355)

**Files modified**:
- ClientEndpoints.swift
- ClientFormSheet.swift

---

### 3. Add Team to Project from Quick Actions ✅ COMPLETED
**Issue**: When adding team members to a project from project quick actions, the team members are not syncing to Bubble.

**Status**: ✅ All functionality implemented and tested

**Completed fixes**:
- ✅ Added `updateProjectTeamMembers()` in ProjectEndpoints.swift (lines 451-470)
- ✅ Updated ProjectManagementSheets.swift to call team sync after modifications (lines 626-629)

**Files modified**:
- ProjectEndpoints.swift
- ProjectManagementSheets.swift

---

### 4. Edit Address in Project Details View ✅ COMPLETED
**Issue**: Address editing is extremely glitchy when driving, with constant updates causing the UI to jump around.

**Status**: ✅ All functionality implemented and tested

**Completed fixes**:
- ✅ Added debouncing for map region changes (1.5 second delay)
- ✅ Added `isUserEditingText` flag to prevent updates while editing
- ✅ Increased coordinate change threshold from 0.0001 to 0.001 for less sensitive updates
- ✅ Added debouncing for text field changes (0.8 second delay)
- ✅ Prevented reverse geocoding while user is actively editing

**Files modified**:
- ProjectDetailsView.swift (AddressEditorSheet)

---

### 5. Manual Sync Should Fetch Everything ✅ COMPLETED
**Issue**: Manual sync does not fetch all company data.

**Status**: ✅ All functionality implemented and tested

**Completed fixes**:
- ✅ Added `manualFullSync()` in SyncManager.swift (lines 1203-1234)
- ✅ Updated `refreshProjectsFromBackend()` in DataController.swift to call comprehensive sync
- ✅ Manual sync now fetches: company data, team members, clients, projects, tasks, calendar events, task types

**Files modified**:
- SyncManager.swift
- DataController.swift

---

## New Features

### 6. Sync Progress Indicator
**Feature**: Show visual feedback when there are pending sync operations.

**Requirements**:
- Display progress bar at top of screen when sync items are pending
- Show count of items waiting to sync (e.g., "Syncing 3 items...")
- Progress bar should appear/disappear smoothly
- Should be visible across all screens while sync is in progress

**Implementation notes**:
- Hook into SyncManager to track pending sync items
- Create reusable SwiftUI component for progress bar
- Use environment/state management to show/hide across views

**Files likely involved**:
- `SyncManager.swift` - expose pending sync count
- New component: `SyncProgressBar.swift`
- Main app view to host progress bar

---

## Known Issues

### 7. Settings Search Navigation
**Issue**: Settings search navigation works for some results but not all.

**Symptoms**:
- Some search results successfully navigate to setting
- Other search results fail to navigate or go to wrong location

**Investigation needed**:
- Identify which settings fail to navigate
- Determine root cause (incorrect navigation paths? missing handlers?)
- Fix navigation for all settings

**Files likely involved**:
- Settings search implementation
- Settings navigation router

---

## Priority Order

1. ✅ ~~**HIGH**: Add project linking (clients + company + calendar event)~~ - COMPLETED
2. ✅ ~~**HIGH**: Add client to company's client list~~ - COMPLETED
3. ✅ ~~**MEDIUM**: Add team members sync to Bubble~~ - COMPLETED
4. ✅ ~~**MEDIUM**: Manual sync fetch everything~~ - COMPLETED
5. ✅ ~~**MEDIUM**: Edit address glitchiness~~ - COMPLETED
6. **HIGH**: Sync progress indicator (user-facing feature) - MOVED TO LAST
7. **LOW**: Settings search navigation issues

---

## Notes

- Ensure all Bubble field names are verified before implementation (don't guess!)
- Test all quick actions thoroughly after fixes
- Consider adding more logging for sync operations
- Calendar event creation should be consistent across all entry points
