# Development Tasks - October 29, 2025

**Date Created**: November 3, 2025
**Priority**: High
**Status**: In Progress

## Critical Bugs & Issues

### 1. Task Card Duplication on Swipe-to-Change-Status üî¥
**Location**: Job Board ‚Üí Task List
**Issue**: Swiping a task card to change status duplicates that task instead of updating status
**Expected**: Status should change without creating duplicate
**Priority**: High - Affects data integrity

**Steps to Reproduce**:
1. Navigate to Job Board ‚Üí Tasks section
2. Swipe task card to change status
3. Observe duplicate task created

**Investigation Needed**:
- Check if task is being created instead of updated
- Verify status update API call vs create API call
- Review UniversalJobBoardCard swipe gesture handling for tasks
- Check if needsSync flag is causing duplicate sync

---

### 2. Calendar Event Not Created Instantly from Project Details üî¥
**Location**: Schedule View ‚Üí Project Search ‚Üí Project Details ‚Üí Schedule Date
**Issue**: Scheduling a date for unscheduled project doesn't create calendar event instantly
- Only sets project start date field
- Calendar event appears to be created only on app relaunch
- Not syncing immediately

**Expected**: Calendar event should be created immediately when date is set

**Investigation Needed**:
- Check `ProjectDetailsView` date scheduling logic
- Verify `CalendarSchedulerSheet` creates CalendarEvent immediately
- Check if marking for sync with `needsSync` flag
- Review `SyncManager` calendar event creation
- Verify API endpoint being called for calendar event creation

**Related Code**:
- `OPS/Views/Components/Project/ProjectDetailsView.swift`
- `OPS/Views/Components/Scheduling/CalendarSchedulerSheet.swift`
- `OPS/Network/Endpoints/CalendarEventEndpoints.swift`
- `OPS/Network/Sync/SyncManager.swift`

---

### 3. Same Issue for Task Scheduling from Search üî¥
**Location**: Schedule View ‚Üí Search Bar ‚Üí Task ‚Üí Schedule Date
**Issue**: Same calendar event creation delay as project scheduling
- Setting task dates doesn't create calendar event instantly
- Event appears only after app relaunch

**Investigation Needed**:
- Check `TaskDetailsView` date scheduling logic
- Verify task calendar event creation vs marking for sync
- Review relationship between ProjectTask and CalendarEvent

**Related Code**:
- `OPS/Views/Components/Project/TaskDetailsView.swift`
- `OPS/Views/Components/Scheduling/CalendarSchedulerSheet.swift`

---

### 4. App Settings Footer Scrolls with Content üü°
**Location**: Settings ‚Üí App Settings
**Issue**: Footer (OPS APP, version, copyright) scrolls with content instead of being pinned to bottom
**Expected**: Footer should remain fixed at bottom of screen

**Priority**: Medium - UX polish

**Investigation Needed**:
- Check `SettingsView.swift` layout structure
- Review footer implementation in app settings section
- Use `.safeAreaInset(edge: .bottom)` or similar for fixed footer

**Related Code**:
- `OPS/Views/SettingsView.swift`

---

### 5. Deleted Project Not Removed After Sync üî¥
**Location**: Bubble ‚Üí Delete Project ‚Üí App Manual Sync
**Issue**: Projects deleted on Bubble backend remain in app after sync
- Manual sync button in calendar view doesn't remove deleted projects
- Second sync attempt (close app, relaunch) still shows deleted project

**Expected**: Sync should detect and remove projects that no longer exist on Bubble

**Priority**: High - Data consistency issue

**Investigation Needed**:
- Check if `SyncManager` handles deletion detection
- Review if sync performs full replacement or incremental updates
- Verify deleted projects are being filtered out during fetch
- Check if local projects need manual deletion when not in API response
- Review `fetchProjects()` and `syncProjects()` logic

**Related Code**:
- `OPS/Network/Sync/SyncManager.swift`
- `OPS/Network/Endpoints/ProjectEndpoints.swift`
- `OPS/Utilities/DataController.swift`

---

## Data Integrity Audit Required üîç

### 6. Verify All Data Type Field Names Match Bubble
**Priority**: High - Foundation for all other issues

**Task**: Comprehensive audit of field name mappings between iOS app and Bubble backend

**Process**:
1. Review all SwiftData model properties
2. Compare with Bubble database field names
3. Check all DTOs (Data Transfer Objects)
4. Verify field name mappings in:
   - `OPS/Network/API/BubbleFields.swift`
   - All DTO files in `OPS/Network/DTOs/`
   - Model files in `OPS/DataModels/`

**Models to Audit**:
- [ ] Project
- [ ] ProjectTask
- [ ] CalendarEvent
- [ ] TaskType
- [ ] User
- [ ] Company
- [ ] Client
- [ ] SubClient
- [ ] TeamMember
- [ ] TaskStatusOption

**Documentation Reference**:
- See `BUBBLE_FIELD_MAPPINGS.md` for current mappings
- Compare with live Bubble database schema

---

### 7. Audit All Sync Operations
**Priority**: High - Ensure data consistency

**Task**: Verify all sync operations are comprehensive and correct

**Sync Triggers to Review**:
1. **App Launch Sync** (`DataController.performAppLaunchSync()`)
2. **Manual Sync Button** (Calendar View)
3. **Background Sync** (`SyncManager.triggerBackgroundSync()`)
4. **Connectivity Restored Sync** (`ConnectivityMonitor` callback)
5. **Save Operations** (individual model updates)

**Verification Checklist**:
- [ ] All data types are included in sync operations
- [ ] Sync order is correct (dependencies handled)
- [ ] Deletion detection and handling
- [ ] Create vs Update logic is correct
- [ ] Relationship updates are synced
- [ ] Calendar events sync with projects/tasks
- [ ] needsSync flags are properly set and cleared
- [ ] Error handling doesn't leave data in inconsistent state

**Related Code**:
- `OPS/Network/Sync/SyncManager.swift` (primary sync logic)
- `OPS/Utilities/DataController.swift` (sync orchestration)
- `OPS/Network/Endpoints/*.swift` (all endpoint files)

---

## Implementation Notes

### Debugging Approach
1. Add comprehensive logging to sync operations
2. Log all API requests/responses for affected operations
3. Add breakpoints in swipe gesture handlers
4. Monitor ModelContext changes during operations
5. Check needsSync flags after operations

### Testing Requirements
- Test all scenarios in both online and offline modes
- Verify sync after network reconnection
- Test with empty/new projects and tasks
- Test with existing data
- Verify behavior after app termination and relaunch

---

## Priority Order
1. üî¥ **P0**: Data integrity issues (#1, #2, #3, #5)
2. üîç **P0**: Data audit (#6, #7) - May solve other issues
3. üü° **P1**: UX polish (#4)

## Next Steps
1. Start with data field audit (#6) - may reveal root causes
2. Review sync operations (#7) - understand current behavior
3. Fix calendar event creation issues (#2, #3)
4. Fix task duplication issue (#1)
5. Fix deletion sync issue (#5)
6. Polish footer positioning (#4)

---

**Notes**: Some issues may be interconnected. The data field audit and sync operation review should be completed first as they may reveal the root causes of other issues.
