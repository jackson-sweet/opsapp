# Development Tasks - October 24, 2025

## Project Create Sheet - Network Error Timing
**Status**: Not Started
**Priority**: High

**Task**: Project creation sheet shows network error immediately even with strong connection. Should only show error if upload persists >5 seconds.

**Issues**:
- Network error appears immediately despite strong connection
- Should have 5-second timeout before showing error message
- Project description field not uploading to Bubble

**Implementation**:
- Review ProjectFormSheet.swift timeout logic
- Ensure 5-second timeout is properly enforced
- Fix project description field sync to Bubble API
- Verify all project fields are being uploaded correctly

---

## Job Board Horizontal Padding
**Status**: Not Started
**Priority**: Medium

**Task**: Job board still missing horizontal padding despite previous implementation attempt.

**Current**: No horizontal padding on job board
**Expected**: Consistent 16pt horizontal padding

**Investigation**: Check if padding was applied correctly in JobBoardView.swift

---

## App Launch Sync - Complete Data Fetch
**Status**: Not Started
**Priority**: Critical

**Task**: On app launch sync, ensure we fetch ALL clients, projects, and tasks from Bubble.

**Current Issue**: App launch sync may not be fetching complete dataset
**Required**: Full sync of all entities on app startup

**Implementation**:
- Review SyncManager.swift app launch sync logic
- Ensure complete fetch of:
  - All clients
  - All projects
  - All tasks
- Verify no pagination or limit issues
- Test with large datasets

---

## Manual Sync Not Working
**Status**: Not Started
**Priority**: High

**Task**: Manual sync in schedule view is not functioning.

**Issue**: Only company sync appears to be working, other entity syncs failing

**Investigation**:
- Check manual sync trigger in schedule view
- Review SyncManager sync methods
- Verify API endpoints are being called
- Check for error messages in console

---

## Settings Search Bar - Keyboard Overlap
**Status**: Not Started
**Priority**: Medium

**Task**: Search bar in settings causes keyboard to push up page content.

**Current**: Keyboard pushes content up when search bar is focused
**New**: Replace with search icon that opens sheet with search function

**Implementation**:
- Remove inline search bar from settings
- Add search icon button to header
- Create search sheet modal
- Implement search functionality in sheet
- Prevent keyboard from affecting main view layout

---

## Fetch Projects API Error
**Status**: Not Started
**Priority**: Critical

**Task**: "Fetch Company Projects" in developer tools throws API error.

**Error**: `OPS.APIError error 3` when fetching projects manually
**Status**:
- Fetch company clients: ✅ Works properly
- Post/Patch project: ✅ Works properly
- Post/Patch client: ✅ Works properly
- Fetch projects: ❌ Failing with error 3

**Investigation**:
- Check ProjectEndpoints.swift fetch method
- Review API error code 3 definition
- Compare working client fetch vs failing project fetch
- Check for API endpoint differences
- Verify request headers and parameters

---

## Task Type Color Upload Issue
**Status**: Not Started
**Priority**: Medium

**Task**: Creating new task type works, but color is not uploaded correctly to Bubble.

**Issue**: Color code uploaded without '#' prefix
**Example**:
- Expected: `#59779F`
- Actual: `59779F`

**Implementation**:
- Check TaskTypeFormSheet.swift or relevant form
- Ensure '#' prefix is included when sending color to API
- Verify TaskType DTO includes '#' in color field
- Test color upload with various hex codes

---

## Update Data Parsing for New Bubble Field Names
**Status**: Not Started
**Priority**: Critical

**Task**: Update all DTOs and data parsing to match new camelCase Bubble field names.

**Background**: All Bubble field names have been updated to use camelCase naming convention. Need to update app's data parsing layer to match.

**Note**: Built-in Bubble fields remain unchanged:
- `_id` (unique identifier)
- `Creator`
- `Modified Date` → `modifiedDate`
- `Created Date` → `createdDate`
- `Slug` → `slug`

### Field Name Changes by Entity:

**Company Object** (CompanyDTO.swift):
- `Company Name` → `companyName`
- `company id` → `companyId`
- `Company Description` → `companyDescription`
- `Open Hour` → `openHour`
- `Close Hour` → `closeHour`
- `Office Email` → `officeEmail`
- `company_size` → `companySize`
- `company_age` → `companyAge`
- `Active Projects` → `activeProjects`
- `Completed Projects` → `completedProjects`
- `Late Projects` → `lateProjects`
- `Calendar.EventsList` → `calendarEventsList`
- `Task Types` → `taskTypes`
- `Client` → `clients`
- `Estimates` → `estimates`
- `Invoice` → `invoices`
- `QB Connected` → `qbConnected`
- `qb.accesstoken` → `qbAccessToken`
- `qb.authbasic` → `qbAuthBasic`
- `qb.code` → `qbCode`
- `qb.companyid` → `qbCompanyId`
- `qb.idtoken` → `qbIdToken`
- `qb.refreshtoken` → `qbRefreshToken`
- `Security Clearances` → `securityClearances`
- `Referral Method` → `referralMethod`
- `Referral Method Other` → `referralMethodOther`
- `AccountHolder` → `accountHolder`

**Project Object** (ProjectDTO.swift):
- `All Day` → `allDay`
- `Client Email` → `clientEmail`
- `Client Name` → `clientName`
- `Client Phone` → `clientPhone`
- `Project Gross Cost` → `projectGrossCost`
- `Project Images` → `projectImages`
- `Project Name` → `projectName`
- `Project Value` → `projectValue`
- `Start Date` → `startDate`
- `Team Members` → `teamMembers`
- `Team Notes` → `teamNotes`

**User Object** (UserDTO.swift):
- `Company Description` → `companyDescription`
- `Company Name` → `companyName`
- `Employee Type` → `employeeType` (determines role: admin, office crew, field crew)
- `Name First` → `nameFirst`
- `Name Last` → `nameLast`
- `Full Name` → `fullName`
- `Home Address` → `homeAddress`
- `Profile Completed Date` → `profileCompletedDate` (NOT a Bubble field)
- `user PIN` → `userPin` (NOT a Bubble field)
- `User Type` → `userType`
- `User Color` → `userColor`
- `Dev Permission` → `devPermission`

**CalendarEvent Object** (CalendarEventDTO.swift):
- `End Date` → `endDate`
- `Start Date` → `startDate`
- `Team Members` → `teamMembers`
- `Type` → `eventType` (renamed from 'type')

**Task Object** (TaskDTO.swift):
- `projectID` → `projectId` (lowercase 'Id')
- `Team Members` → `teamMembers`

**Client Object** (ClientDTO.swift):
- `Client ID No` → `clientIdNo`
- `Clients List` → `clientsList`
- `Email Address` → `emailAddress`
- `Estimates List` → `estimates` (changed from 'estimatesList')
- `Is Company` → `isCompany`
- `Parent Company` → `parentCompany`
- `Phone Number` → `phoneNumber`
- `Projects List` → `projectsList`
- `Thumbnail` → `avatar` (renamed from 'thumbnail')
- `User ID` → `userId`
- `Sub Clients` → `subClients`

**TaskType Object** (TaskTypeDTO.swift):
- No field name changes (already camelCase)

### Option Set Updates:

Option set names changed to remove spaces and capitalize words:
- `CalendarEventType`
- `TaskType`
- `TaskStatus`
- `JobStatus`
- `EmployeeType`
- `CompanySize`
- `CompanyAge`
- `UserType`
- `SubscriptionStatus`
- `SubscriptionPlan`

**Important**: Option set `Display` field remains capitalized (Bubble built-in field)

### Implementation Steps:

1. **Update DTO CodingKeys**:
   - Update all `CodingKeys` enums in DTO files to match new field names
   - Ensure proper camelCase mapping

2. **Update Model Mappings**:
   - Review `toModel()` methods in DTOs
   - Ensure all field mappings use new names

3. **Update API Requests**:
   - Review all POST/PATCH/PUT endpoints
   - Ensure request bodies use new field names

4. **Update Option Set Parsing**:
   - Review enum decode logic for option sets
   - Ensure Display field handling remains uppercase

5. **Test All Endpoints**:
   - Company CRUD
   - Project CRUD
   - User CRUD
   - CalendarEvent CRUD
   - Task CRUD
   - Client CRUD
   - TaskType CRUD

6. **Update BUBBLE_FIELD_MAPPINGS.md**:
   - Document all field name changes
   - Update examples with new field names

**Files to Update**:
- `OPS/Network/DTOs/CompanyDTO.swift`
- `OPS/Network/DTOs/ProjectDTO.swift`
- `OPS/Network/DTOs/UserDTO.swift`
- `OPS/Network/DTOs/CalendarEventDTO.swift`
- `OPS/Network/DTOs/TaskDTO.swift`
- `OPS/Network/DTOs/ClientDTO.swift`
- `OPS/Network/DTOs/TaskTypeDTO.swift`
- All Endpoints files that construct API requests
- `BUBBLE_FIELD_MAPPINGS.md`

---

## Update BUBBLE_FIELD_MAPPINGS.md Documentation
**Status**: Not Started
**Priority**: Medium

**Task**: Update BUBBLE_FIELD_MAPPINGS.md to reflect new camelCase naming convention for all Bubble fields.

**Current**: Documentation references old field names with spaces and inconsistent casing
**New**: Update all field references to use new camelCase names

**Implementation**:
- Review entire BUBBLE_FIELD_MAPPINGS.md file
- Update all field name references to match new camelCase convention
- Update code examples to use new field names
- Update mapping tables with new names
- Add note about built-in Bubble fields that cannot be changed
- Document option set naming changes
- Ensure consistency with actual Bubble implementation

**Files to Update**:
- `BUBBLE_FIELD_MAPPINGS.md`

**Note**: This documentation update should be done alongside the DTO updates to ensure accuracy.

---

## Summary

### Critical Priority: 3 tasks
1. App Launch Sync - Complete Data Fetch
2. Fetch Projects API Error
3. Update Data Parsing for New Bubble Field Names

### High Priority: 2 tasks
1. Project Create Sheet - Network Error Timing
2. Manual Sync Not Working

### Medium Priority: 4 tasks
1. Job Board Horizontal Padding
2. Settings Search Bar - Keyboard Overlap
3. Task Type Color Upload Issue
4. Update BUBBLE_FIELD_MAPPINGS.md Documentation

**Total Active Tasks**: 9

---

## Notes

**Breaking Change**: The Bubble field name updates are a breaking change that will affect all API communication. This task should be prioritized and completed before other sync-related fixes, as the field name mismatches may be the root cause of several sync issues including:
- Fetch Projects API Error (error 3)
- Manual Sync failures
- Project description not uploading

**Recommended Order**:
1. Update Data Parsing for New Bubble Field Names (Critical - fixes root cause)
2. Test all CRUD operations to verify field name fixes
3. Then proceed with other sync-related tasks
