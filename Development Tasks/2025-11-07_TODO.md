# TODO - November 7, 2025

## High Priority Issues

### âœ… FIXED: Calendar Events Not Displaying
- **Issue**: Events shown in Bubble, but not on calendar in app. Specifically: created a project in app, quick action: add task without assigning start date, quick action: reschedule project. Task shows on Bubble calendar but not in app.
- **Status**: FIXED - Replaced `shouldDisplay` with `active` field check

### âœ… FIXED: Clients Not Being Fetched on Fresh Load
- **Issue**: When loading all data from scratch, clients are not being fetched (project cards all visible, but client information that should be in cards is blank)
- **Status**: FIXED - Added `linkAllRelationships()` to sync process

---

## Active Tasks

### 1. Quick Action Reschedule Task Selection
**Status**: âœ… COMPLETE
**Priority**: HIGH

**Issue**:
- Job board projects list: quick action reschedule should ask user which task to reschedule if there are multiple tasks
- If there is only one task, should reschedule that task automatically
- Currently attempts to reschedule the project, even if it has tasks

**Implementation**:
- [ ] Check if project has tasks when reschedule quick action is tapped
- [ ] If 1 task: automatically open scheduler for that task
- [ ] If multiple tasks: show task picker sheet first
- [ ] If no tasks: reschedule project (existing behavior)

**Files to Modify**:
- UniversalJobBoardCard.swift (quick action logic)
- Possibly create new TaskPickerSheet component

---

### 2. Full Sync on Login
**Status**: âœ… COMPLETE
**Priority**: HIGH

**Issue**:
- After logging in, user currently has to close and open app again to load jobs
- Need to trigger full sync immediately after successful login

**Implementation**:
- [ ] Trigger `syncManager.performFullSync()` after login completes
- [ ] Show loading indicator during sync
- [ ] Navigate to main view only after sync completes

**Files to Modify**:
- AuthManager.swift (login completion handler)
- LoginView.swift or wherever login is handled

---

### 3. Scheduler View Opening Delay
**Status**: âœ… COMPLETE
**Priority**: MEDIUM

**Issue**:
- Big delay after tapping start date field (in both project details and task details view) before the scheduler view opens

**Root Cause Identified**:
- CalendarSchedulerSheet was calling `getCalendarEvents(for:)` 180 times (once per day in 6-month range)
- Each call fetched ALL calendar events from database and filtered in memory
- Total: 180 database queries + NÃ—180 filter operations

**Solution Implemented**:
- Created optimized `getCalendarEvents(in: ClosedRange<Date>)` method in DataController
- Fetches all events in single query and filters efficiently
- Reduced to: 1 database query + N filter operations (~180x faster)

**Files Modified**:
- DataController.swift (added optimized range query method)
- CalendarSchedulerSheet.swift (updated to use new method)

---

### 4. Create Project with Task Type
**Status**: âœ… COMPLETE
**Priority**: MEDIUM

**Issue**:
- In create project flow, allow user to set a task type
- Behind the scenes, this should create a task for the project and assign the type to that task

**Implementation Completed**:
- âœ… Added optional task type picker to ProjectFormSheet in expandable section
- âœ… Task type picker shows all active task types with icons and colors
- âœ… User can select/deselect task types (optional field)
- âœ… Project `eventType` set to `.task` if task type selected, `.project` otherwise
- âœ… Created `createInitialTask()` helper function
- âœ… Initial task inherits project's dates, team members, and location
- âœ… Task and calendar event created with `needsSync = true` for background sync

**Files Modified**:
- ProjectFormSheet.swift (added task type UI and creation logic)

---

## Future Features (Not Started)

### NEW FEATURE: RFI (Request for Information) Section
**Status**: ðŸ’¡ IDEA
**Priority**: FUTURE

**Description**:
- Add RFI section to a project where team can ask questions
- Implementation details TBD

---

---

### 5. Refresh View After Scheduler Saves Date Changes
**Status**: âœ… COMPLETE
**Priority**: HIGH

**Issue**:
- When scheduler is used to update dates, view doesn't refresh to show new dates
- User has to navigate away and back to see updated information

**Solution Implemented**:
- Added `@State private var refreshTrigger` to ProjectDetailsView and TaskDetailsView
- Toggle `refreshTrigger` after schedule updates and clear operations complete
- Applied `.id(refreshTrigger)` modifier to dates section to force re-render

**Files Modified**:
- ProjectDetailsView.swift (added refresh trigger and UI updates)
- TaskDetailsView.swift (added refresh trigger and UI updates)

---

### 6. Loading Overlay Not Displaying After Login
**Status**: âœ… COMPLETE
**Priority**: HIGH

**Issue**:
- Post-login loading overlay not appearing during sync
- `isPerformingInitialSync` state changes not triggering UI updates

**Solution Implemented**:
- Wrapped all `isPerformingInitialSync` state changes with `await MainActor.run {}`
- Ensures state changes happen on main thread for SwiftUI to detect

**Files Modified**:
- DataController.swift (fixed main actor state updates)

---

### 7. Project Carousel Not Showing Today's Events
**Status**: âœ… COMPLETE
**Priority**: HIGH

**Issue**:
- After login sync completes, today's events don't appear in project carousel
- User must navigate to different screen and back to see events

**Solution Implemented**:
- Added `.onChange(of: dataController.isPerformingInitialSync)` to HomeView
- Automatically reloads today's projects when sync completes
- Ensures carousel shows events immediately after login

**Files Modified**:
- HomeView.swift (added sync completion watcher)

---

## Summary
- âœ… Complete: 9 items (2 initial fixes + 7 tasks)
- ðŸ”´ Pending: 0 items
- ðŸ’¡ Future: 1 item

## All Active Tasks Completed! ðŸŽ‰

All high and medium priority tasks from November 7, 2025 have been successfully completed:
1. Quick action reschedule with smart task selection
2. Full sync on login with loading overlay
3. Loading overlay properly displayed after login on home screen
4. Scheduler opening delay fixed (~180x performance improvement)
5. Task type selection in create project flow
6. View refresh after scheduler saves date changes
7. Loading overlay displaying correctly after login
8. Project carousel showing today's events immediately after sync
